-- Aggregating Data
-- Study aggregate functions like COUNT, SUM, AVG, MAX, and MIN.
-- Learn to use the GROUP BY clause to group data.
-- Practice writing queries that involve aggregating data.


CREATE TABLE products (
    product_id INT PRIMARY KEY,
    category_id INT,
    name VARCHAR(100),
    price DECIMAL(10, 2)
);

INSERT INTO products (product_id, category_id, name, price)
VALUES
(1, 101, 'Product A', 10.50),
(2, 102, 'Product B', 20.25),
(3, 101, 'Product C', 15.75),
(4, 103, 'Product D', 30.00),
(5, 102, 'Product E', 25.50),
(6, 101, 'Product F', 18.75),
(7, 103, 'Product G', 32.25),
(8, 102, 'Product H', 22.00),
(9, 101, 'Product I', 12.50),
(10, 103, 'Product J', 35.75);


CREATE TABLE employees (
    employee_id INT PRIMARY KEY,
    department_id INT,
    name VARCHAR(100),
    salary DECIMAL(10, 2)
);

INSERT INTO employees (employee_id, department_id, name, salary)
VALUES
(1, 201, 'John Doe', 50000.00),
(2, 202, 'Jane Smith', 60000.00),
(3, 201, 'David Brown', 55000.00),
(4, 203, 'Emily Johnson', 62000.00),
(5, 202, 'Michael Davis', 58000.00),
(6, 201, 'Sarah Wilson', 53000.00),
(7, 203, 'James Miller', 61000.00),
(8, 202, 'Jessica Lee', 59000.00),
(9, 201, 'Daniel Martinez', 54000.00),
(10, 203, 'Emma Taylor', 63000.00);

CREATE TABLE orders (
    order_id INT PRIMARY KEY,
    customer_id INT,
    order_date DATE
);

INSERT INTO orders (order_id, customer_id, order_date)
VALUES
(1, 301, '2024-01-01'),
(2, 302, '2024-01-05'),
(3, 301, '2024-01-10'),
(4, 303, '2024-01-15'),
(5, 302, '2024-01-20'),
(6, 301, '2024-01-25'),
(7, 303, '2024-01-30'),
(8, 302, '2024-02-01'),
(9, 301, '2024-02-05'),
(10, 303, '2024-02-10');

CREATE TABLE order_items (
    item_id INT PRIMARY KEY,
    order_id INT,
    product_id INT,
    quantity INT,
    price DECIMAL(10, 2)
);

INSERT INTO order_items (item_id, order_id, product_id, quantity, price)
VALUES
(1, 1, 1, 2, 10.50),
(2, 1, 2, 1, 20.25),
(3, 2, 3, 3, 15.75),
(4, 2, 4, 1, 30.00),
(5, 3, 5, 2, 25.50),
(6, 4, 6, 1, 18.75),
(7, 4, 7, 1, 32.25),
(8, 5, 8, 2, 22.00),
(9, 6, 9, 1, 12.50),
(10, 7, 10, 3, 35.75);



-- Practice Questions:

-- 1. Write a SQL query to retrieve the average price of products in each category from the "products" table.
SELECT category_id, 
AVG(price) AS average_price
FROM products
GROUP BY category_id;
 
-- 2. Write a SQL query to retrieve the maximum salary for each department from the "employees" table.
SELECT department_id, 
MAX(salary) AS max_salary
FROM employees
GROUP BY department_id;


-- 3. Write a SQL query to retrieve the total revenue generated by each customer from the "orders" and "order items" tables.
SELECT o.customer_id, 
SUM(oi.quantity * oi.price) AS total_revenue
FROM orders o
JOIN order_items oi ON o.order_id = oi.order_id
GROUP BY o.customer_id;


-- 4. Write a SQL query to retrieve the total number of orders for each customer from the "orders" table.
SELECT customer_id, 
COUNT(order_id) AS total_orders
FROM orders
GROUP BY customer_id;